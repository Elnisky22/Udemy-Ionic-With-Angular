"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2188],{2188:(T,D,r)=>{r.r(D),r.d(D,{PlaceDetailPageModule:()=>P});var B=r(177),g=r(4341),o=r(7125),p=r(1313),e=r(9498);const M=["f"];function b(n,c){if(1&n){const a=e.RV6();e.j41(0,"ion-datetime",18),e.mxI("ngModelChange",function(t){e.eBV(a);const s=e.XpG();return e.DH7(s.startDate,t)||(s.startDate=t),e.Njj(t)}),e.k0s()}if(2&n){const a=e.XpG();e.Y8G("min",a.availableFrom)("max",a.availableTo),e.R50("ngModel",a.startDate)}}function S(n,c){if(1&n){const a=e.RV6();e.j41(0,"ion-datetime",19),e.mxI("ngModelChange",function(t){e.eBV(a);const s=e.XpG();return e.DH7(s.endDate,t)||(s.endDate=t),e.Njj(t)}),e.k0s()}if(2&n){const a=e.XpG();e.Y8G("min",a.startDate)("max",a.availableTo),e.R50("ngModel",a.endDate)}}let j=(()=>{var n;class c{constructor(i){this.modalController=i,this.startDate=(new Date).toISOString().split("T")[0]}ngOnInit(){if(this.selectedPlace&&(this.availableFrom=this.selectedPlace.availableFrom.toISOString().split("T")[0],this.availableTo=this.selectedPlace.availableTo.toISOString().split("T")[0]),"random"===this.selectedMode){const i=new Date(this.availableFrom),t=new Date(this.availableTo);this.startDate=new Date(i.getTime()+Math.random()*(t.getTime()-6048e5-i.getTime())).toISOString().split("T")[0],this.endDate=new Date(new Date(this.startDate).getTime()+Math.random()*(t.getTime()-new Date(this.startDate).getTime())).toISOString().split("T")[0]}}onCancel(){this.modalController.dismiss(null,"cancel")}onBookPlace(){!this.form.valid||!this.datesValid()||this.modalController.dismiss({bookingData:{firstName:this.form.value["first-name"],lastName:this.form.value["last-name"],guestNumber:+this.form.value["guest-number"],startDate:new Date(this.form.value["date-from"]),endDate:new Date(this.form.value["date-to"])}},"confirm")}datesValid(){if(!this.form)return!1;const i=this.form.value["date-from"],t=this.form.value["date-to"];return void 0!==i&&void 0!==t&&new Date(t)>new Date(i)}}return(n=c).\u0275fac=function(i){return new(i||n)(e.rXU(o.W3))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-create-booking"]],viewQuery:function(i,t){if(1&i&&e.GBs(M,5),2&i){let s;e.mGM(s=e.lsd())&&(t.form=s.first)}},inputs:{selectedPlace:"selectedPlace",selectedMode:"selectedMode"},decls:44,vars:4,consts:[["f","ngForm"],["slot","end"],[3,"click"],["slot","icon-only","name","close"],[1,"ion-padding"],[3,"ngSubmit"],["size","12","size-sm","6","offset-sm","3"],["type","text","label","First Name","labelPlacement","floating","ngModel","","name","first-name","required",""],["type","text","label","Last Name","labelPlacement","floating","ngModel","","name","last-name","required",""],["label","Number of Guests","labelPlacement","floating","ngModel","","name","guest-number","value","2"],["value","1"],["value","2"],["value","3"],["datetime","date-from"],[3,"keepContentsMounted"],["size","12","size-sm","6"],["datetime","date-to"],["type","submit","expand","block",3,"disabled"],["id","date-from","presentation","date","name","date-from","required","",3,"ngModelChange","min","max","ngModel"],["id","date-to","presentation","date","name","date-to","required","",3,"ngModelChange","min","max","ngModel"]],template:function(i,t){if(1&i){const s=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",1)(5,"ion-button",2),e.bIt("click",function(){return e.eBV(s),e.Njj(t.onCancel())}),e.nrm(6,"ion-icon",3),e.k0s()()()(),e.j41(7,"ion-content",4)(8,"form",5,0),e.bIt("ngSubmit",function(){return e.eBV(s),e.Njj(t.onBookPlace())}),e.j41(10,"ion-grid")(11,"ion-row")(12,"ion-col",6)(13,"ion-item"),e.nrm(14,"ion-input",7),e.k0s()(),e.j41(15,"ion-col",6)(16,"ion-item"),e.nrm(17,"ion-input",8),e.k0s()(),e.j41(18,"ion-col",6)(19,"ion-item")(20,"ion-select",9)(21,"ion-select-option",10),e.EFF(22,"1"),e.k0s(),e.j41(23,"ion-select-option",11),e.EFF(24,"2"),e.k0s(),e.j41(25,"ion-select-option",12),e.EFF(26,"3"),e.k0s()()()(),e.j41(27,"ion-col",6)(28,"ion-item")(29,"ion-label"),e.EFF(30,"Available from"),e.k0s(),e.nrm(31,"ion-datetime-button",13),e.j41(32,"ion-modal",14),e.DNE(33,b,1,3,"ng-template"),e.k0s()()(),e.j41(34,"ion-col",15)(35,"ion-item")(36,"ion-label"),e.EFF(37,"Available to"),e.k0s(),e.nrm(38,"ion-datetime-button",16),e.j41(39,"ion-modal",14),e.DNE(40,S,1,3,"ng-template"),e.k0s()()(),e.j41(41,"ion-col",6)(42,"ion-button",17),e.EFF(43," Confirm book "),e.k0s()()()()()()}if(2&i){const s=e.sdS(9);e.R7$(3),e.JRh(null==t.selectedPlace?null:t.selectedPlace.title),e.R7$(29),e.Y8G("keepContentsMounted",!0),e.R7$(7),e.Y8G("keepContentsMounted",!0),e.R7$(3),e.Y8G("disabled",!s.valid||!t.datesValid())}},dependencies:[o.bv,o.Jm,o.QW,o.hU,o.W9,o.A9,o.K4,o.lO,o.eU,o.iq,o.$w,o.uz,o.he,o.ln,o.Nm,o.Ip,o.BC,o.ai,o.Sb,o.Je,o.Gw,g.YN,g.qT,g.BC,g.cb,g.YS,g.vS,g.cV],encapsulation:2}),c})();var I=r(3656),h=r(8591),f=r(8244),k=r(5498);function l(n,c){1&n&&(e.j41(0,"div",6),e.nrm(1,"ion-spinner",7),e.k0s())}function m(n,c){if(1&n){const a=e.RV6();e.j41(0,"ion-grid")(1,"ion-row")(2,"ion-col",8),e.nrm(3,"ion-img",9),e.k0s()(),e.j41(4,"ion-row")(5,"ion-col",8)(6,"p"),e.EFF(7),e.k0s()()(),e.j41(8,"ion-row")(9,"ion-col",8)(10,"ion-button",10),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.onBookPlace())}),e.EFF(11," Book "),e.k0s()()()()}if(2&n){const a=e.XpG();e.R7$(3),e.Y8G("src",null==a.place?null:a.place.imageUrl),e.R7$(4),e.JRh(null==a.place?null:a.place.description),e.R7$(3),e.Y8G("disabled",!a.isBookable)}}const v=[{path:"",component:(()=>{var n;class c{constructor(i,t,s,u,F,N,G,R,y,x){this.route=i,this.navController=t,this.placesService=s,this.modalController=u,this.actionSheetController=F,this.bookingService=N,this.loadingCtrl=G,this.authService=R,this.alertCtrl=y,this.router=x,this.isBookable=!1,this.isLoading=!1}ngOnInit(){this.route.paramMap.subscribe(i=>{if(!i.has("placeId"))return void this.navController.navigateBack("/places/tabs/discover");this.isLoading=!0;const t=i.get("placeId");this.placeSub=this.placesService.getPlace(t).subscribe(s=>{this.place=s,this.isBookable=(null==s?void 0:s.userId)!==this.authService.userId,this.isLoading=!1},s=>{this.alertCtrl.create({header:"An error ocurred",message:"Could not fetch place",buttons:[{text:"Okay",handler:()=>{this.router.navigate(["/places/tabs/discover"])}}]}).then(u=>{u.present()})})})}ngOnDestroy(){this.placeSub&&this.placeSub.unsubscribe()}onBookPlace(){this.actionSheetController.create({header:"Choose an action",buttons:[{text:"Select Date",handler:()=>{console.log("Selected date!"),this.openBookingModal("select")}},{text:"Random",handler:()=>{this.openBookingModal("random")}},{text:"Cancel",role:"cancel"}]}).then(i=>{i.present()})}openBookingModal(i){this.modalController.create({component:j,componentProps:{selectedPlace:this.place,selectedMode:i}}).then(t=>(t.present(),t.onDidDismiss())).then(t=>{console.log(t.data,t.role),"confirm"===t.role&&this.loadingCtrl.create({message:"Booking place..."}).then(s=>{s.present();const u=t.data.bookingData;this.bookingService.addBooking(this.place.id,this.place.title,this.place.imageUrl,u.firstName,u.lastName,u.guestNumber,u.startDate,u.endDate).subscribe(()=>{s.dismiss()})})})}}return(n=c).\u0275fac=function(i){return new(i||n)(e.rXU(p.nX),e.rXU(I.q9),e.rXU(h._),e.rXU(o.W3),e.rXU(o.GD),e.rXU(f.L),e.rXU(o.Xi),e.rXU(k.u),e.rXU(o.hG),e.rXU(p.Ix))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-place-detail"]],standalone:!1,decls:9,vars:5,consts:[[3,"translucent"],["slot","start"],["defaultHref","/places/tabs/discover"],[3,"fullscreen"],["class","ion-text-center",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center"],["name","bubbles"],["size","12","size-sm","6","offset-sm","3"],[3,"src"],["color","primary","expand","block",3,"click","disabled"]],template:function(i,t){1&i&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e.nrm(3,"ion-back-button",2),e.k0s(),e.j41(4,"ion-title"),e.EFF(5),e.k0s()()(),e.j41(6,"ion-content",3),e.DNE(7,l,2,0,"div",4)(8,m,12,3,"ion-grid",5),e.k0s()),2&i&&(e.Y8G("translucent",!0),e.R7$(5),e.JRh(t.isLoading?"":null==t.place?null:t.place.title),e.R7$(),e.Y8G("fullscreen",!0),e.R7$(),e.Y8G("ngIf",t.isLoading),e.R7$(),e.Y8G("ngIf",!t.isLoading))},dependencies:[B.bT,o.Jm,o.QW,o.hU,o.W9,o.lO,o.eU,o.KW,o.ln,o.w2,o.BC,o.ai,o.el],encapsulation:2}),c})()}];let C=(()=>{var n;class c{}return(n=c).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[p.iI.forChild(v),p.iI]}),c})(),P=(()=>{var n;class c{}return(n=c).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[B.MD,g.YN,o.bv,C,j]}),c})()},8244:(T,D,r)=>{r.d(D,{L:()=>I});var B=r(4412),g=r(6354),o=r(8141),p=r(5558),e=r(6697);class M{constructor(f,k,l,m,d,v,C,P,n,c){this.id=f,this.placeId=k,this.userId=l,this.placeTitle=m,this.placeImage=d,this.firstName=v,this.lastName=C,this.guestNumber=P,this.bookedFrom=n,this.bookedTo=c}}var b=r(9498),S=r(5498),j=r(1626);let I=(()=>{var h;class f{get bookings(){return this._bookings.asObservable()}constructor(l,m){this.authService=l,this.http=m,this._bookings=new B.t([])}fetchBookings(){return this.http.get(`https://ionic-angular-6476b-default-rtdb.firebaseio.com/bookings.json?orderBy="userId"&equalTo="${this.authService.userId}"`).pipe((0,g.T)(l=>{const m=[];for(const d in l)l.hasOwnProperty(d)&&m.push(new M(d,l[d].placeId,l[d].userId,l[d].placeTitle,l[d].placeImage,l[d].firstName,l[d].lastName,l[d].guestNumber,new Date(l[d].bookedFrom),new Date(l[d].bookedTo)));return m}),(0,o.M)(l=>{this._bookings.next(l)}))}addBooking(l,m,d,v,C,P,n,c){let a;const i=new M(Math.random().toString(),l,this.authService.userId,m,d,v,C,P,n,c);return this.http.post("https://ionic-angular-6476b-default-rtdb.firebaseio.com/bookings.json",{...i,id:null}).pipe((0,p.n)(t=>(a=t.name,this.bookings)),(0,e.s)(1),(0,o.M)(t=>{i.id=a,this._bookings.next(t.concat(i))}))}cancelBooking(l){return this.http.delete(`https://ionic-angular-6476b-default-rtdb.firebaseio.com/bookings/${l}.json`).pipe((0,p.n)(()=>this.bookings),(0,e.s)(1),(0,o.M)(m=>{this._bookings.next(m.filter(d=>d.id!==l))}))}}return(h=f).\u0275fac=function(l){return new(l||h)(b.KVO(S.u),b.KVO(j.Qq))},h.\u0275prov=b.jDH({token:h,factory:h.\u0275fac,providedIn:"root"}),f})()}}]);